{% extends "base.html" %}

{% block content %}
<style>
    /* --- 新增样式：用于创建两栏布局 --- */
    .main-container {
        display: flex;
        gap: 20px; /* 栏间距 */
    }
    .posts-column {
        flex: 3; /* 帖子栏占 3 份宽度 */
    }
    .remarks-column {
        flex: 2; /* 备注栏占 2 份宽度 */
        border-left: 1px solid #eee;
        padding-left: 20px;
    }
    .remark-card {
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 10px;
    }
    .remark-card blockquote {
        margin: 0 0 10px 0;
        padding-left: 10px;
        border-left: 3px solid #ccc;
        font-style: italic;
        color: #555;
    }
    .highlight { /* 简化高亮样式 */
        background-color: yellow;
        cursor: pointer;
    }
</style>

<h1>我们的共同笔记本</h1>

{% if user %}
    <h2>欢迎回来, {{ user.username }}!</h2>
{% else %}
    <h2>欢迎! 请登录或注册来发布内容。</h2>
{% endif %}

<hr>

<div class="main-container">
    <div class="posts-column">
        <h3>内容墙:</h3>
        {% if posts %}
            {% for post in posts %}
                <div class="post-container" data-post-id="{{ post.id }}" style="border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; border-radius: 5px;">
                    <p class="post-content" style="white-space: pre-wrap; word-wrap: break-word;">{{ post.content }}</p>
                    <small>发布者: <strong>{{ post.author.username }}</strong> 于 {{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>

                    {# 【新功能！】只有当登录用户是作者时，才显示删除按钮 #}
                    {% if user and user.id == post.author.id %}
                        <form action="{{ url_for('delete_post', post_id=post.id) }}" method="post" style="display: inline; margin-left: 10px;">
                            <button type="submit" onclick="return confirm('你确定要删除这篇内容吗？');">删除</button>
                        </form>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <p>这里还没有任何内容，快去发布第一条吧！</p>
        {% endif %}
    </div>

    <div class="remarks-column">
        <h3>备注列表:</h3>
        <div id="remarks-list">
            <p>点击高亮区域可查看对应备注。</p>
        </div>
    </div>
</div>
{% endblock %}


{% block scripts %}
<script>
    // (这部分JavaScript代码和之前一样，为了简洁省略，你粘贴完整版即可)
    document.addEventListener('DOMContentLoaded', () => {
        const remarksByPost = {{ remarks_by_post | tojson }};
        const remarksListDiv = document.getElementById('remarks-list');

        function renderExistingRemarks() {
            remarksListDiv.innerHTML = '<p>点击高